extends layout.pug

block content
  .container.mt-3
    if plugs.length > 0
      h1 Prese
      .row
        each plug in plugs
          - var classType = plug.status.toLowerCase() == 'accesa' ? 'success' : 'danger';
          .col-md-2.my-1
            .card.text-center(class='card-outline-' + classType)
              .card-block
                h4.card-title.pb-2(class='text-' + classType) #[i.fa.fa-2x.fa-plug]
                h6.card-subtitle.mb-2.text-muted #{plug.name}
                span #{plug.status}
    hr
    h1 Panoramica
    .row
      .col-md-4.my-3
        .card.card-outline-success.text-center
          .card-block
            h4.card-title.text-success #[i.fa.fa-3x.fa-sun-o]
            h6.card-subtitle.mb-2.text-muted Produzione
            span #{generating} W
      .col-md-4.my-3
        .card.card-outline-danger.text-center
          .card-block
            h4.card-title.text-danger #[i.fa.fa-3x.fa-fire]
            h6.card-subtitle.mb-2.text-muted Consumo
            span #{consuming} W
      .col-md-4.my-3
        .card.card-outline-info.text-center
          .card-block
            h4.card-title.text-info #[i.fa.fa-3x.fa-cloud-upload]
            h6.card-subtitle.mb-2.text-muted Esportazione
            span #{exporting} W
      .col-md-4.my-3
        .card.text-center
          .card-block
            h4.card-title #[i.fa.fa-3x.fa-signal]
            h6.card-subtitle.mb-2.text-muted Potenza segnale
            span #{signal.signal.quality}%
            br
            span #{signal.timestamp}
      .col-md-8.my-3
        .card.text-center
          .card-block
            #overview-chart(style={width: '100%', height: '340px'})
    br
    form
      .form-group
        label(for='plugPower') Potenza soglia
        .input-group
          input.form-control.col-md-3(type='text', name='plugPower', value=plugPower)
          .input-group-addon W
      button.btn.btn-primary(type='submit') #[i.fa.fa-save] Salva
block additionalScripts
  script.
    var overviewGraph = !{JSON.stringify(overviewGraph)};
    $(function () {
      Highcharts.chart('overview-chart', {
        title: null,
        xAxis: {
            categories: _.map(overviewGraph, function (v) { return moment(v.timestamp).format('HH:mm:ss'); })
        },
        yAxis: {
            title: {
                text: 'Watt (W)'
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        },
        tooltip: {
            valueSuffix: 'W'
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'middle',
            borderWidth: 0
        },
        series: [{
            name: 'Produzione',
            color: '#5cb85c',
            data: _.map(overviewGraph, 'generating')
        }, {
            name: 'Consumo',
            color: '#d9534f',
            data: _.map(overviewGraph, 'consuming')
        }]
    });

    });
  